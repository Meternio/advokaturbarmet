export class NullSwiper{constructor(){this.swipers=document.querySelectorAll(".clip__swiper")}init(){for(let t=0,i=this.swipers.length;t<i;t++){let i=this.swipers[t],r=i.querySelectorAll(".clipper");new e({parent:i,slides:r}).init()}}update(){this.swipers=document.querySelectorAll(".clip__swiper"),this.init()}}class e{constructor(e){this.parent=e.parent,this.clippers=e.slides}init(){let e=this.parent,t=this.clippers,i=e.getBoundingClientRect().width,r=e.querySelector(".aspect__ratio"),n=e.querySelector(".clip__background").querySelector("img"),l=e.querySelector(".bullets"),s=l.querySelectorAll(".bullet"),d=l.querySelector(".insert"),a=!s.length>0,c=e.querySelector(".credits"),o=e.querySelectorAll(".credit"),u=[],g=e=>gsap.timeline({defaults:{overwrite:"auto"}});for(let e=0,i=t.length;e<i;e++)u[e]=g();let p,x=!1,h=parseInt(e.getAttribute("data-slides")),f=0,v=!1,y="true"===e.getAttribute("data-autoplay"),w=e.getAttribute("data-interval"),S=6,q={dragging:!1,dirSet:!1,dir:"next",dirChange:!1,index:0},m=(e,t=q.dir)=>{switch(t){case"next":return e+1===h?0:e+1;case"prev":return e-1<0?h-1:e-1}},b=(e,i,r)=>{a?d.innerText=e+1:(l.querySelector(".active").classList.remove("active"),s[e].classList.add("active")),c.querySelector(".active").classList.remove("active"),o[e].classList.add("active");let p="inset(0% 0% 0% 0%)",x="next"===r?"inset(0% 0% 0% 100%)":"inset(0% 100% 0% 0%)";if(n.src=t[e].querySelector("img").src,q.dragging&&(q.dirChange&&v?(p="prev"===r?"inset(0% 0% 0% 100%)":"inset(0% 100% 0% 0%)",x=t[q.index].style.clipPath):x="next"===r?`inset(0% 0% 0% ${i}%)`:`inset(0% ${i}% 0% 0%)`),u[e].kill(),u[e]=g(),t[e].style.clipPath=x,t[e].style.zIndex=S,u[e].fromTo([t[e]],{clipPath:x},{clipPath:p,duration:.95,ease:"Expo.easeOut"}),q.dirChange&&v){q.dirChange=!1;let e="next"===q.dir?"prev":"next";q.index=m(q.index,e)}console.log(q.index)},A=()=>{for(let e=0,r=t.length;e<r;e++)t[e].querySelector(".slide").style.width=`${i}px`};(()=>{x=!0;let t=e.querySelectorAll(".lazy");if("IntersectionObserver"in window){let t=new IntersectionObserver((function(e){e.forEach((e=>{if(e.intersectionRatio>0){t.unobserve(e.target);let i=e.target.querySelectorAll(".lazy");if(i.length>0)for(let e=0,t=i.length;e<t;e++)i[e].innerHTML=i[e].getAttribute("data-html")}}))}),{rootMargin:"50px 0px",threshold:.01});t.observe(e)}else for(let e=0,i=t.length;e<i;e++)t[e].innerHTML=t[e].getAttribute("data-html")})(),A();new NullInteract({element:r,onStart:function(){y&&(y=!1,clearInterval(I))},onMove:function(){if(x)if(q.dirSet)if(q.dirChange&&v){u[q.index].kill();let e=100-(100-f-100/i*this.result.distanceX);e=e>=100?100:e<=0?0:e,t[q.index].style.clipPath="prev"===q.dir?`inset(0 0 0 ${e}%)`:`inset(0 ${e}% 0 0)`,t[q.index].style.zIndex=S}else{let e=100-100/i*this.result.distanceX;e=e>=100?100:e<=0?0:e,t[q.index].style.clipPath="next"===q.dir?`inset(0 0 0 ${e}%)`:`inset(0 ${e}% 0 0)`,t[q.index].style.zIndex=S}else if(this.result.distanceX>=5){S++,q.dragging=!0,q.dirSet=!0;let e=this.result.deltaX>=0?"prev":"next";q.dirChange=e!==q.dir,q.dir=e,v=u[q.index].progress()<1,q.dirChange&&v?(u[q.index].kill(),f=parseInt(t[q.index].style.clipPath.split(".")[0].replace(/[^0-9]/g,""))):q.index=m(q.index)}},onEnd:function(){if(x&&q.dragging){if(q.dirChange&&v<1){let e=100-f-100/i*this.result.distanceX;e=e>=100?100:e<=0?0:e,b(q.index,e,q.dir),v=!1}else{let e=100-100/i*this.result.distanceX;e=e>=100?100:e<=0?0:e,b(q.index,e,q.dir),void 0!==p&&window.clearTimeout(p),p=window.setTimeout((()=>{q.dragging=!1}),100)}q.dirSet=!1}}});r.addEventListener("click",(t=>{if(y&&(y=!1,clearInterval(I)),x&&!q.dragging){let r=t.clientX-e.offsetLeft;q.dir=r>i/2?"next":"prev",q.index=m(q.index),S++,b(q.index,0,q.dir)}}));for(let e=0,t=s.length;e<t;e++)s[e].addEventListener("click",(()=>{if(x){y&&(y=!1,clearInterval(I));let t=index(s[e])>q.index?"next":"prev";q.index=index(s[e]),S++,b(q.index,0,t)}}));let I=!!y&&window.setInterval((()=>{x&&(q.index=m(q.index),S++,b(q.index,0,"next"))}),{slowest:2e4,slow:1e4,medium:8e3,fast:6e3,fastest:4e3}[w]);window.addEventListener("resize",(()=>{i=e.getBoundingClientRect().width,A()}))}}
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImR5bmFtaWMvbnVsbHN3aXBlci5qcyJdLCJuYW1lcyI6WyJOdWxsU3dpcGVyIiwiW29iamVjdCBPYmplY3RdIiwidGhpcyIsInN3aXBlcnMiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJpIiwibGVuIiwibGVuZ3RoIiwicGFyZW50IiwiY2xpcHBlcnMiLCJDbGlwU3dpcGVyIiwic2xpZGVzIiwiaW5pdCIsIm9iaiIsInBhcmVudFdpZHRoIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0Iiwid2lkdGgiLCJpbm5lciIsInF1ZXJ5U2VsZWN0b3IiLCJjbGlwQmFja2dyb3VuZCIsImJ1bGxldFBhcmVudCIsImJ1bGxldHMiLCJjb3VudGVySW5zZXJ0IiwiY291bnRlckFjdGl2ZSIsImNyZWRpdHNQYXJlbnQiLCJjcmVkaXRzIiwidGltZWxpbmVzIiwiYWRkVGltZWxpbmUiLCJnc2FwIiwidGltZWxpbmUiLCJkZWZhdWx0cyIsIm92ZXJ3cml0ZSIsInRpbWVvdXQiLCJsYXp5bG9hZGVkIiwicGFyc2VJbnQiLCJnZXRBdHRyaWJ1dGUiLCJraWxsZWRWYWx1ZSIsImluUHJvZ3Jlc3MiLCJhdXRvcGxheSIsImludGVydmFsS2V5IiwiekluZGV4IiwiYWN0aW9uSW5mbyIsImRyYWdnaW5nIiwiZGlyU2V0IiwiZGlyIiwiZGlyQ2hhbmdlIiwiaW5kZXgiLCJmbkdldEFuaW1hdGVJbmRleCIsImFjdGl2ZUluZGV4IiwiZm5SdW5BbmltYXRpb24iLCJzdGFydFZhbHVlIiwiaW5uZXJUZXh0IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwiYWRkIiwiY2xpcE9wZW4iLCJjbGlwU3RhcnQiLCJzcmMiLCJzdHlsZSIsImNsaXBQYXRoIiwia2lsbCIsImZyb21UbyIsImR1cmF0aW9uIiwiZWFzZSIsInJlc2V0RGlyIiwiY29uc29sZSIsImxvZyIsImZuU2V0SW1hZ2VXaWR0aCIsImxhenlFbGVtZW50cyIsIndpbmRvdyIsIm9ic2VydmVyIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImVudHJ5IiwiaW50ZXJzZWN0aW9uUmF0aW8iLCJ1bm9ic2VydmUiLCJ0YXJnZXQiLCJpbWFnZXMiLCJpbm5lckhUTUwiLCJyb290TWFyZ2luIiwidGhyZXNob2xkIiwib2JzZXJ2ZSIsImZuTGF6eWxvYWRpbmciLCJOdWxsSW50ZXJhY3QiLCJlbGVtZW50Iiwib25TdGFydCIsImNsZWFySW50ZXJ2YWwiLCJpbnRlcnZhbCIsIm9uTW92ZSIsInJlc3VsdCIsImRpc3RhbmNlWCIsImRlbHRhWCIsInByb2dyZXNzIiwic3BsaXQiLCJyZXBsYWNlIiwib25FbmQiLCJ1bmRlZmluZWQiLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJ4IiwiY2xpZW50WCIsIm9mZnNldExlZnQiLCJzZXRJbnRlcnZhbCIsInNsb3dlc3QiLCJzbG93IiwibWVkaXVtIiwiZmFzdCIsImZhc3Rlc3QiXSwibWFwcGluZ3MiOiJPQUFPLE1BQU1BLFdBQ1RDLGNBQ0lDLEtBQUtDLFFBQVVDLFNBQVNDLGlCQUFpQixpQkFHN0NKLE9BQ0ksSUFBSyxJQUFJSyxFQUFJLEVBQUdDLEVBQU1MLEtBQUtDLFFBQVFLLE9BQVFGLEVBQUlDLEVBQUtELElBQUssQ0FDckQsSUFBSUcsRUFBU1AsS0FBS0MsUUFBUUcsR0FDdEJJLEVBQVdELEVBQU9KLGlCQUFpQixZQU92QyxJQUFJTSxFQUxpQixDQUNqQkYsT0FBVUEsRUFDVkcsT0FBVUYsSUFHaUJHLFFBSXZDWixTQUNJQyxLQUFLQyxRQUFVQyxTQUFTQyxpQkFBaUIsaUJBQ3pDSCxLQUFLVyxRQVFiLE1BQU1GLEVBQ0ZWLFlBQVlhLEdBRVJaLEtBQUtPLE9BQVNLLEVBQVksT0FDMUJaLEtBQUtRLFNBQVdJLEVBQVksT0FHaENiLE9BRUksSUFBSVEsRUFBU1AsS0FBS08sT0FDZEMsRUFBV1IsS0FBS1EsU0FDaEJLLEVBQWNOLEVBQU9PLHdCQUF3QkMsTUFDN0NDLEVBQVFULEVBQU9VLGNBQWMsa0JBQzdC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VUFBVyxJQUN2QixLQUdQRCxFQUFXRSxRQUFTLE1BTXBDMUIsRUFBTW1GLGlCQUFpQixTQUFVQyxJQU03QixHQUxJL0QsSUFDQUEsR0FBVyxFQUNYaUQsY0FBY0MsSUFHZHZELElBQ0tRLEVBQVdDLFNBQVUsQ0FDdEIsSUFBSTRELEVBQUlELEVBQUVFLFFBQVUvRixFQUFPZ0csV0FDM0IvRCxFQUFXRyxJQUFNMEQsRUFBS3hGLEVBQWMsRUFBSyxPQUFTLE9BQ2xEMkIsRUFBV0ssTUFBUUMsRUFBa0JOLEVBQVdLLE9BQ2hETixJQUNBUyxFQUFlUixFQUFXSyxNQUFPLEVBQUdMLEVBQVdHLFNBTTNELElBQUssSUFBSXZDLEVBQUksRUFBR0MsRUFBTWUsRUFBUWQsT0FBUUYsRUFBSUMsRUFBS0QsSUFDM0NnQixFQUFRaEIsR0FBRytGLGlCQUFpQixTQUFTLEtBQ2pDLEdBQUluRSxFQUFZLENBQ1JLLElBQ0FBLEdBQVcsRUFDWGlELGNBQWNDLElBR2xCLElBQUk1QyxFQUFNRSxNQUFNekIsRUFBUWhCLElBQU1vQyxFQUFXSyxNQUFRLE9BQVMsT0FDMURMLEVBQVdLLE1BQVFBLE1BQU16QixFQUFRaEIsSUFDakNtQyxJQUNBUyxFQUFlUixFQUFXSyxNQUFPLEVBQUdGLE9BTWhELElBQUk0QyxJQUFXbEQsR0FBVytCLE9BQU9vQyxhQW5OaEIsS0FDVHhFLElBQ0FRLEVBQVdLLE1BQVFDLEVBQWtCTixFQUFXSyxPQUNoRE4sSUFDQVMsRUFBZVIsRUFBV0ssTUFBTyxFQUFHLFdBbEV0QixDQUNsQjRELFFBQVcsSUFDWEMsS0FBUSxJQUNSQyxPQUFVLElBQ1ZDLEtBQVEsSUFDUkMsUUFBVyxLQTRRMER2RSxJQU16RThCLE9BQU8rQixpQkFBaUIsVUFBVSxLQUM5QnRGLEVBQWNOLEVBQU9PLHdCQUF3QkMsTUFDN0NtRCIsImZpbGUiOiJkeW5hbWljL251bGxzd2lwZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY2xhc3MgTnVsbFN3aXBlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuc3dpcGVycyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jbGlwX19zd2lwZXInKTtcbiAgICB9XG5cbiAgICBpbml0KCkge1xuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuID0gdGhpcy5zd2lwZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBsZXQgcGFyZW50ID0gdGhpcy5zd2lwZXJzW2ldO1xuICAgICAgICAgICAgbGV0IGNsaXBwZXJzID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jbGlwcGVyJyk7XG5cbiAgICAgICAgICAgIGxldCBzd2lwZXJTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICAncGFyZW50JzogcGFyZW50LFxuICAgICAgICAgICAgICAgICdzbGlkZXMnOiBjbGlwcGVyc1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgbmV3IENsaXBTd2lwZXIoc3dpcGVyU2V0dGluZ3MpLmluaXQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHVwZGF0ZSgpIHtcbiAgICAgICAgdGhpcy5zd2lwZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNsaXBfX3N3aXBlcicpO1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG59XG5cbi8qXG4qICAgIFRPRE86IEZpeCB3cm9uZyBidWxsZXRzIGFmdGVyIGRpciBjaGFuZ2VcbiogKi9cblxuY2xhc3MgQ2xpcFN3aXBlciB7XG4gICAgY29uc3RydWN0b3Iob2JqKSB7XG4gICAgICAgIC8vIEVsZW1lbnRzXG4gICAgICAgIHRoaXMucGFyZW50ID0gb2JqWydwYXJlbnQnXTtcbiAgICAgICAgdGhpcy5jbGlwcGVycyA9IG9ialsnc2xpZGVzJ107XG4gICAgfVxuXG4gICAgaW5pdCgpIHtcbiAgICAgICAgLy8gRWxlbWVudHNcbiAgICAgICAgbGV0IHBhcmVudCA9IHRoaXMucGFyZW50O1xuICAgICAgICBsZXQgY2xpcHBlcnMgPSB0aGlzLmNsaXBwZXJzO1xuICAgICAgICBsZXQgcGFyZW50V2lkdGggPSBwYXJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICAgIGxldCBpbm5lciA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcuYXNwZWN0X19yYXRpbycpO1xuICAgICAgICBsZXQgY2xpcEJhY2tncm91bmQgPSBwYXJlbnQucXVlcnlTZWxlY3RvcignLmNsaXBfX2JhY2tncm91bmQnKS5xdWVyeVNlbGVjdG9yKCdpbWcnKTtcbiAgICAgICAgbGV0IGJ1bGxldFBhcmVudCA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcuYnVsbGV0cycpO1xuICAgICAgICBsZXQgYnVsbGV0cyA9IGJ1bGxldFBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCcuYnVsbGV0Jyk7XG4gICAgICAgIGxldCBjb3VudGVySW5zZXJ0ID0gYnVsbGV0UGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5pbnNlcnQnKTtcbiAgICAgICAgbGV0IGNvdW50ZXJBY3RpdmUgPSAhYnVsbGV0cy5sZW5ndGggPiAwO1xuICAgICAgICBsZXQgY3JlZGl0c1BhcmVudCA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKCcuY3JlZGl0cycpO1xuICAgICAgICBsZXQgY3JlZGl0cyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY3JlZGl0Jyk7XG5cbiAgICAgICAgLy9HU0FQXG4gICAgICAgIGxldCB0aW1lbGluZXMgPSBbXTtcbiAgICAgICAgbGV0IGFkZFRpbWVsaW5lID0gKGkpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBnc2FwLnRpbWVsaW5lKHtcbiAgICAgICAgICAgICAgICBkZWZhdWx0czoge292ZXJ3cml0ZTogXCJhdXRvXCJ9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNsaXBwZXJzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB0aW1lbGluZXNbaV0gPSBhZGRUaW1lbGluZShpKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2xhc3MgcmVsYXRlZCBhY3Rpb24gaW5mb3JtYXRpb25zXG4gICAgICAgIGxldCBsYXp5bG9hZGVkID0gZmFsc2U7XG5cbiAgICAgICAgLy8gR2VuZXJhbCBJbmZvcm1hdGlvbnNcbiAgICAgICAgbGV0IGxlbmd0aCA9IHBhcnNlSW50KHBhcmVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2xpZGVzJykpO1xuICAgICAgICBsZXQga2lsbGVkVmFsdWUgPSAwO1xuICAgICAgICBsZXQgaW5Qcm9ncmVzcyA9IGZhbHNlO1xuXG4gICAgICAgIC8vIFNldHRpbmdzXG4gICAgICAgIGxldCBhdXRvcGxheSA9IHBhcmVudC5nZXRBdHRyaWJ1dGUoJ2RhdGEtYXV0b3BsYXknKSA9PT0gJ3RydWUnLFxuICAgICAgICAgICAgaW50ZXJ2YWxLZXkgPSBwYXJlbnQuZ2V0QXR0cmlidXRlKCdkYXRhLWludGVydmFsJyksXG4gICAgICAgICAgICB6SW5kZXggPSA2O1xuXG4gICAgICAgIC8vIEludGVydmFsIFNldHRpbmdzXG4gICAgICAgIGxldCBpbnRlcnZhbFRpbWluZ3MgPSB7XG4gICAgICAgICAgICAnc2xvd2VzdCc6IDIwMDAwLFxuICAgICAgICAgICAgJ3Nsb3cnOiAxMDAwMCxcbiAgICAgICAgICAgICdtZWRpdW0nOiA4MDAwLFxuICAgICAgICAgICAgJ2Zhc3QnOiA2MDAwLFxuICAgICAgICAgICAgJ2Zhc3Rlc3QnOiA0MDAwXG4gICAgICAgIH07XG5cbiAgICAgICAgbGV0IHRpbWVvdXQ7XG5cbiAgICAgICAgLy8gQWN0aW9uIGluZm9ybWF0aW9uc1xuICAgICAgICBsZXQgYWN0aW9uSW5mbyA9IHtcbiAgICAgICAgICAgICdkcmFnZ2luZyc6IGZhbHNlLFxuICAgICAgICAgICAgJ2RpclNldCc6IGZhbHNlLFxuICAgICAgICAgICAgJ2Rpcic6ICduZXh0JyxcbiAgICAgICAgICAgICdkaXJDaGFuZ2UnOiBmYWxzZSxcbiAgICAgICAgICAgICdpbmRleCc6IDAsXG4gICAgICAgIH07XG5cblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgIC8vIERlY2xhcmUgRnVuY3Rpb25zXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgbGV0IGZuTGF6eWxvYWRpbmcgPSAoKSA9PiB7XG4gICAgICAgICAgICBsYXp5bG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGxldCBsYXp5RWxlbWVudHMgPSBwYXJlbnQucXVlcnlTZWxlY3RvckFsbCgnLmxhenknKTtcblxuICAgICAgICAgICAgaWYgKCEoJ0ludGVyc2VjdGlvbk9ic2VydmVyJyBpbiB3aW5kb3cpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGxhenlFbGVtZW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBsYXp5RWxlbWVudHNbaV0uaW5uZXJIVE1MID0gbGF6eUVsZW1lbnRzW2ldLmdldEF0dHJpYnV0ZSgnZGF0YS1odG1sJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSBpbWFnZSBnZXRzIHdpdGhpbiA1MHB4IGluIHRoZSBZIGF4aXMsIHN0YXJ0IHRoZSBkb3dubG9hZC5cbiAgICAgICAgICAgICAgICAgICAgcm9vdE1hcmdpbjogJzUwcHggMHB4JyxcbiAgICAgICAgICAgICAgICAgICAgdGhyZXNob2xkOiAwLjAxXG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIFRoZSBvYnNlcnZlciBmb3IgdGhlIGltYWdlcyBvbiB0aGUgcGFnZVxuICAgICAgICAgICAgICAgIGxldCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihsYXp5bG9hZCwgY29uZmlnKTtcbiAgICAgICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKHBhcmVudCk7XG5cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBsYXp5bG9hZChlbnRyaWVzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgZW50cmllc1xuICAgICAgICAgICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXJlIHdlIGluIHZpZXdwb3J0P1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5LmludGVyc2VjdGlvblJhdGlvID4gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcCB3YXRjaGluZyBhbmQgbG9hZCB0aGUgaW1hZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci51bm9ic2VydmUoZW50cnkudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgaW1hZ2VzID0gZW50cnkudGFyZ2V0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5sYXp5Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGltYWdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBpbWFnZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltYWdlc1tpXS5pbm5lckhUTUwgPSBpbWFnZXNbaV0uZ2V0QXR0cmlidXRlKCdkYXRhLWh0bWwnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGZuQXV0b3BsYXkgPSAoKSA9PiB7XG4gICAgICAgICAgICBpZiAobGF6eWxvYWRlZCkge1xuICAgICAgICAgICAgICAgIGFjdGlvbkluZm8uaW5kZXggPSBmbkdldEFuaW1hdGVJbmRleChhY3Rpb25JbmZvLmluZGV4KTtcbiAgICAgICAgICAgICAgICB6SW5kZXgrKztcbiAgICAgICAgICAgICAgICBmblJ1bkFuaW1hdGlvbihhY3Rpb25JbmZvLmluZGV4LCAwLCAnbmV4dCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCBmbkdldEFuaW1hdGVJbmRleCA9IChhY3RpdmVJbmRleCwgZGlyID0gYWN0aW9uSW5mby5kaXIpID0+IHtcbiAgICAgICAgICAgIHN3aXRjaCAoZGlyKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAnbmV4dCc6XG4gICAgICAgICAgICAgICAgICAgIGlmICgoYWN0aXZlSW5kZXggKyAxKSA9PT0gbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3RpdmVJbmRleCArIDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYXNlICdwcmV2JzpcbiAgICAgICAgICAgICAgICAgICAgaWYgKChhY3RpdmVJbmRleCAtIDEpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxlbmd0aCAtIDE7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYWN0aXZlSW5kZXggLSAxO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGZuUnVuQW5pbWF0aW9uID0gKGluZGV4LCBzdGFydFZhbHVlLCBkaXIpID0+IHtcbiAgICAgICAgICAgIC8vIENoYW5nZSBCdWxsZXRwb2ludCBhbmQgQ3JlZGl0c1xuICAgICAgICAgICAgaWYgKGNvdW50ZXJBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICBjb3VudGVySW5zZXJ0LmlubmVyVGV4dCA9IGluZGV4ICsgMTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgYnVsbGV0UGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY3RpdmUnKS5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICBidWxsZXRzW2luZGV4XS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY3JlZGl0c1BhcmVudC5xdWVyeVNlbGVjdG9yKCcuYWN0aXZlJykuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICBjcmVkaXRzW2luZGV4XS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgLy8gR2V0IFZhbHVlcyBmb3Igc3RhcnQgYW5pbWF0ZVxuICAgICAgICAgICAgbGV0IGNsaXBPcGVuID0gYGluc2V0KDAlIDAlIDAlIDAlKWA7XG4gICAgICAgICAgICBsZXQgY2xpcFN0YXJ0ID0gZGlyID09PSAnbmV4dCcgPyBgaW5zZXQoMCUgMCUgMCUgMTAwJSlgIDogYGluc2V0KDAlIDEwMCUgMCUgMCUpYDtcbiAgICAgICAgICAgIGNsaXBCYWNrZ3JvdW5kLnNyYyA9IGNsaXBwZXJzW2luZGV4XS5xdWVyeVNlbGVjdG9yKCdpbWcnKS5zcmM7XG5cbiAgICAgICAgICAgIGlmIChhY3Rpb25JbmZvLmRyYWdnaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbkluZm8uZGlyQ2hhbmdlICYmIGluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgY2xpcE9wZW4gPSBkaXIgPT09ICdwcmV2JyA/IGBpbnNldCgwJSAwJSAwJSAxMDAlKWAgOiBgaW5zZXQoMCUgMTAwJSAwJSAwJSlgO1xuICAgICAgICAgICAgICAgICAgICBjbGlwU3RhcnQgPSBjbGlwcGVyc1thY3Rpb25JbmZvLmluZGV4XS5zdHlsZS5jbGlwUGF0aDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjbGlwU3RhcnQgPSBkaXIgPT09ICduZXh0JyA/IGBpbnNldCgwJSAwJSAwJSAke3N0YXJ0VmFsdWV9JSlgIDogYGluc2V0KDAlICR7c3RhcnRWYWx1ZX0lIDAlIDAlKWA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBLaWxsIHRoZSBydW5uaW5nIGFuaW1hdGlvblxuICAgICAgICAgICAgdGltZWxpbmVzW2luZGV4XS5raWxsKCk7XG4gICAgICAgICAgICAvLyBBZGQgYSBuZXcgdGltZWxpbmUgdG8gY2xpcHBlclxuICAgICAgICAgICAgdGltZWxpbmVzW2luZGV4XSA9IGFkZFRpbWVsaW5lKCk7XG4gICAgICAgICAgICAvLyBSZXNldCBjbGlwcGVycyBzdGF0ZSB0byBzdGFydFxuICAgICAgICAgICAgY2xpcHBlcnNbaW5kZXhdLnN0eWxlLmNsaXBQYXRoID0gY2xpcFN0YXJ0O1xuICAgICAgICAgICAgLy8gQWRkIHppbmRleCB0byBlbGVtZW50XG4gICAgICAgICAgICBjbGlwcGVyc1tpbmRleF0uc3R5bGUuekluZGV4ID0gekluZGV4O1xuICAgICAgICAgICAgLy8gUnVuIGFuaW1hdGlvblxuICAgICAgICAgICAgdGltZWxpbmVzW2luZGV4XS5mcm9tVG8oW2NsaXBwZXJzW2luZGV4XV0sIHtjbGlwUGF0aDogY2xpcFN0YXJ0fSwge1xuICAgICAgICAgICAgICAgIGNsaXBQYXRoOiBjbGlwT3BlbixcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMC45NSxcbiAgICAgICAgICAgICAgICBlYXNlOiAnRXhwby5lYXNlT3V0J1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmKGFjdGlvbkluZm8uZGlyQ2hhbmdlICYmIGluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICBhY3Rpb25JbmZvLmRpckNoYW5nZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGxldCByZXNldERpciA9IGFjdGlvbkluZm8uZGlyID09PSAnbmV4dCcgPyAncHJldicgOiAnbmV4dCc7XG4gICAgICAgICAgICAgICAgYWN0aW9uSW5mby5pbmRleCA9IGZuR2V0QW5pbWF0ZUluZGV4KGFjdGlvbkluZm8uaW5kZXgsIHJlc2V0RGlyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGFjdGlvbkluZm8uaW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBmblNldEltYWdlV2lkdGggPSAoKSA9PiB7XG5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBjbGlwcGVycy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICAgIGNsaXBwZXJzW2ldLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZScpLnN0eWxlLndpZHRoID0gYCR7cGFyZW50V2lkdGh9cHhgO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgLy8gU3RhcnQgdGhlIG1hZ2ljXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgICAgICAgZm5MYXp5bG9hZGluZygpO1xuICAgICAgICBmblNldEltYWdlV2lkdGgoKTtcblxuICAgICAgICBsZXQgc3dpcGVyTWFuYWdlciA9IG5ldyBOdWxsSW50ZXJhY3Qoe1xuICAgICAgICAgICAgJ2VsZW1lbnQnOiBpbm5lcixcblxuICAgICAgICAgICAgJ29uU3RhcnQnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGF1dG9wbGF5KSB7XG4gICAgICAgICAgICAgICAgICAgIGF1dG9wbGF5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgICdvbk1vdmUnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxhenlsb2FkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbkluZm8uZGlyU2V0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWN0aW9uSW5mby5kaXJDaGFuZ2UgJiYgaW5Qcm9ncmVzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVsaW5lc1thY3Rpb25JbmZvLmluZGV4XS5raWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHdpZHRoID0gMTAwIC0gKDEwMCAtIGtpbGxlZFZhbHVlIC0gKDEwMCAvIHBhcmVudFdpZHRoICogdGhpcy5yZXN1bHQuZGlzdGFuY2VYKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSB3aWR0aCA+PSAxMDAgPyAxMDAgOiB3aWR0aCA8PSAwID8gMCA6IHdpZHRoO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcHBlcnNbYWN0aW9uSW5mby5pbmRleF0uc3R5bGUuY2xpcFBhdGggPSBhY3Rpb25JbmZvLmRpciA9PT0gJ3ByZXYnID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGluc2V0KDAgMCAwICR7d2lkdGh9JSlgIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYGluc2V0KDAgJHt3aWR0aH0lIDAgMClgO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgWi1JbmRleFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaXBwZXJzW2FjdGlvbkluZm8uaW5kZXhdLnN0eWxlLnpJbmRleCA9IHpJbmRleDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcHBseSBsaXZlIGRyYWdnaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHdpZHRoID0gMTAwIC0gKDEwMCAvIHBhcmVudFdpZHRoICogdGhpcy5yZXN1bHQuZGlzdGFuY2VYKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IHdpZHRoID49IDEwMCA/IDEwMCA6IHdpZHRoIDw9IDAgPyAwIDogd2lkdGg7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwcGVyc1thY3Rpb25JbmZvLmluZGV4XS5zdHlsZS5jbGlwUGF0aCA9IGFjdGlvbkluZm8uZGlyID09PSAnbmV4dCcgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgaW5zZXQoMCAwIDAgJHt3aWR0aH0lKWAgOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBgaW5zZXQoMCAke3dpZHRofSUgMCAwKWA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcHBseSBaLUluZGV4XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcHBlcnNbYWN0aW9uSW5mby5pbmRleF0uc3R5bGUuekluZGV4ID0gekluZGV4O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMucmVzdWx0LmRpc3RhbmNlWCA+PSA1KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgekluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZSBjbGlja2luZyBmbGFnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSW5mby5kcmFnZ2luZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGRpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkluZm8uZGlyU2V0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgZGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHRoaXMucmVzdWx0LmRlbHRhWCA+PSAwID8gJ3ByZXYnIDogJ25leHQnO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkluZm8uZGlyQ2hhbmdlID0gcmVzdWx0ICE9PSBhY3Rpb25JbmZvLmRpcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25JbmZvLmRpciA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgaW5kZXggdG8gYW5pbWF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluUHJvZ3Jlc3MgPSB0aW1lbGluZXNbYWN0aW9uSW5mby5pbmRleF0ucHJvZ3Jlc3MoKSA8IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbkluZm8uZGlyQ2hhbmdlICYmIGluUHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZWxpbmVzW2FjdGlvbkluZm8uaW5kZXhdLmtpbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2lsbGVkVmFsdWUgPSBwYXJzZUludChjbGlwcGVyc1thY3Rpb25JbmZvLmluZGV4XS5zdHlsZS5jbGlwUGF0aC5zcGxpdCgnLicpWzBdLnJlcGxhY2UoL1teMC05XS9nLCAnJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkluZm8uaW5kZXggPSBmbkdldEFuaW1hdGVJbmRleChhY3Rpb25JbmZvLmluZGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAnb25FbmQnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgc3dpcGVyIHdhcyBkcmFnZ2VkXG4gICAgICAgICAgICAgICAgaWYgKGxhenlsb2FkZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFjdGlvbkluZm8uZHJhZ2dpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhY3Rpb25JbmZvLmRpckNoYW5nZSAmJiBpblByb2dyZXNzIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB3aWR0aCA9IDEwMCAtIGtpbGxlZFZhbHVlIC0gKDEwMCAvIHBhcmVudFdpZHRoICogdGhpcy5yZXN1bHQuZGlzdGFuY2VYKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9IHdpZHRoID49IDEwMCA/IDEwMCA6IHdpZHRoIDw9IDAgPyAwIDogd2lkdGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm5SdW5BbmltYXRpb24oYWN0aW9uSW5mby5pbmRleCwgd2lkdGgsIGFjdGlvbkluZm8uZGlyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpblByb2dyZXNzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB3aWR0aCA9IDEwMCAtICgxMDAgLyBwYXJlbnRXaWR0aCAqIHRoaXMucmVzdWx0LmRpc3RhbmNlWCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGggPSB3aWR0aCA+PSAxMDAgPyAxMDAgOiB3aWR0aCA8PSAwID8gMCA6IHdpZHRoO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vekluZGV4Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm5SdW5BbmltYXRpb24oYWN0aW9uSW5mby5pbmRleCwgd2lkdGgsIGFjdGlvbkluZm8uZGlyKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aW1lb3V0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFyVGltZW91dCh0aW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSW5mby5kcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkluZm8uZGlyU2V0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlubmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGlmIChhdXRvcGxheSkge1xuICAgICAgICAgICAgICAgIGF1dG9wbGF5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChsYXp5bG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFhY3Rpb25JbmZvLmRyYWdnaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB4ID0gZS5jbGllbnRYIC0gcGFyZW50Lm9mZnNldExlZnQ7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbkluZm8uZGlyID0geCA+IChwYXJlbnRXaWR0aCAvIDIpID8gJ25leHQnIDogJ3ByZXYnO1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb25JbmZvLmluZGV4ID0gZm5HZXRBbmltYXRlSW5kZXgoYWN0aW9uSW5mby5pbmRleCk7XG4gICAgICAgICAgICAgICAgICAgIHpJbmRleCsrO1xuICAgICAgICAgICAgICAgICAgICBmblJ1bkFuaW1hdGlvbihhY3Rpb25JbmZvLmluZGV4LCAwLCBhY3Rpb25JbmZvLmRpcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBCdWxsZXQgQ2xpY2tzXG4gICAgICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBidWxsZXRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgICBidWxsZXRzW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChsYXp5bG9hZGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhdXRvcGxheSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXV0b3BsYXkgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IGRpciA9IGluZGV4KGJ1bGxldHNbaV0pID4gYWN0aW9uSW5mby5pbmRleCA/ICduZXh0JyA6ICdwcmV2JztcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uSW5mby5pbmRleCA9IGluZGV4KGJ1bGxldHNbaV0pO1xuICAgICAgICAgICAgICAgICAgICB6SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgZm5SdW5BbmltYXRpb24oYWN0aW9uSW5mby5pbmRleCwgMCwgZGlyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENhbGwgYXV0b3BsYXkgaWYgaXMgc2V0XG4gICAgICAgIGxldCBpbnRlcnZhbCA9IGF1dG9wbGF5ID8gd2luZG93LnNldEludGVydmFsKGZuQXV0b3BsYXksIGludGVydmFsVGltaW5nc1tpbnRlcnZhbEtleV0pIDogZmFsc2U7XG5cblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gICAgICAgIC8vIHJlY2FsY3VsYXRlIHN0dWZmIG9uIHdpbmRvdyByZXNpemVcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4ge1xuICAgICAgICAgICAgcGFyZW50V2lkdGggPSBwYXJlbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGg7XG4gICAgICAgICAgICBmblNldEltYWdlV2lkdGgoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufSJdfQ==
